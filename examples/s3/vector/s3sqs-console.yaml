sources:
  s3_logs_source:
    type: "aws_s3"
    region: "us-east-1" 
    sqs:
      queue_url: "$VECTOR_SQS"
    compression: "auto"

transforms:
  explode_audit_events:
    type: "remap"
    inputs: ["s3_logs_source"]
    source: |
      # Parse the stringified JSON into an actual array
      .message = parse_json!(.message)
      . = unnest!(.message)
  flatten_structure:
    type: "remap"
    inputs: ["explode_audit_events"]
    source: |
      . = merge!(., .message)
      del(.message)
sinks:
  # Sink to write events to rotating JSON files on disk
  file_output:
    type: "file"
    inputs: ["flatten_structure"]
    path: "./tmp/json_event/%Y-%m-%dT%H.json"
    encoding:
      codec: "json"
